/**
 *  Hall sensor example code 
 * 
 * This is a code intended to test the hall sensors connections and to demonstrate the hall sensor setup.
 * 
 */

#include <SimpleFOC.h>


int a=0,b=0,c=0;

// Hall sensor instance
// HallSensor(int hallA, int hallB , int cpr, int index)
//  - hallA, hallB, hallC    - HallSensor A, B and C pins
//  - pp                     - pole pairs
HallSensor sensor = HallSensor(A_HALL1, A_HALL2, A_HALL3, 15);

// Interrupt routine intialisation
// channel A and B callbacks
void doA(){a++;}
void doB(){b++;}
void doC(){c++;}


void setup() {
  // monitoring port
  Serial.begin(115200);

  // check if you need internal pullups
  // sensor.pullup = Pullup::USE_EXTERN;
  
  // initialise encoder hardware
  sensor.init();
  // hardware interrupt enable
  // sensor.enableInterrupts(doA, doB, doC);
  attachInterrupt(digitalPinToInterrupt(A_HALL1), doA, CHANGE);
  attachInterrupt(digitalPinToInterrupt(A_HALL2), doB, CHANGE);
  attachInterrupt(digitalPinToInterrupt(A_HALL3), doC, CHANGE);

  Serial.println("Sensor ready");
  _delay(1000);
}

void loop() {
  // iterative function updating the sensor internal variables
  // it is usually called in motor.loopFOC()
  // sensor.update();
  
  // Serial.print(sensor.getAngle());
  // Serial.print("\t");
  // Serial.println(sensor.getVelocity());
  Serial.printf("a:%d, b:%d, c:%d\n", a, b, c);
  delay(100);
}
